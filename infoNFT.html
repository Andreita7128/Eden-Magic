<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css" href="auctionSection.css">
    <link rel="stylesheet" type="text/css" href="finishedAuctionSection.css">
    <link rel="stylesheet" type="text/css" href="twitterSection.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <title>Product info</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="sketch.js"></script>
</head>

<body>

    <header>
        <magic-nav></magic-nav>
    </header>

    <article class="product-card-container">
        <div class="product-card-content">
            <img src="" class="product-img" />
            <div class="product-descripcion">
                <h2></h2>
                <h2>Collection: </h2>
                <br>
                <p></p>
                <br>
                <p>Cryptocurrency: </p>
                <p>Price: </p>
            </div>

            <button class="next-btn">Ver siguiente</button>
        </div>
    </article>

    <script type="module">
        import dataComments from "./public/Components/Comments/dataComment/dataComment.js";

        const COMMENTS = dataComments;
        let position = 0;
        let data = [];
        let products = []

        async function getInfo() {
            const response = await fetch('https://magic-eden-nfts-default-rtdb.firebaseio.com/products.json');
            data = await response.json();

            products = data.map(d => {
                let dCopy = {
                    ...d
                };
                let hasComment = Math.random() > 0.5;
                
                    let indexR = Math.floor( Math.random() * ((6 - 1 + 1) + 1))
                    dCopy.comment = [COMMENTS[indexR]]
                    return dCopy
                
                    
            })
            console.log(products);

            updateProductInfo();
        }

        function updateProductInfo() {
            const product = products[position];
            const productName = document.querySelector('.product-descripcion h2');
            productName.innerText = product.name;
            const productCollection = document.querySelector('.product-descripcion h2:last-of-type');
            productCollection.innerText = product.collection;
            const productImg = document.querySelector('.product-img');
            productImg.src = product.url;
            const productDesc = document.querySelectorAll('.product-descripcion p');
            productDesc.item(0).innerText = product.description;
            productDesc.item(1).innerText = product.cryptocurrency;
            productDesc.item(2).innerText = product.price;
            let comments = document.getElementById("comments")
            comments.innerHTML = ""
            product.comment.forEach((item)=>{
                console.log(item);
                item.forEach((com)=>{
                    comments.innerHTML+= ` <link rel="stylesheet" href="../../../public/Components/Comments/comment.css">
    <article id="comment">
            <p id="comment_user"> ${com.userName}</p>
            <section id="comment_body">
                <img id="comment_img" src=" ${com.pictureProfile} ">
                <div id="comment_text">
                    <p id="comment_comment"> ${com.comment} </p>
                </div>
            </section>
            <section id="comment_reactions">
                <div id="comment_likes">
                    <i class="fa fa-heart" style="margin-right: 16px"></i>
                    <p id="comment_number"> ${com.likes}</p>
                </div>
                <i class="bi bi-three-dots"></i>
            </section>
        </article>`
                })
                
            })
                
                

            
        }

        const nextBtn = document.querySelector('.next-btn');
        nextBtn.addEventListener('click', () => {
            position++;
            if (position >= data.length) {
                position = 0;
            }
            updateProductInfo();
        });

        getInfo();
    </script>

    <section id="comments">
        <h2>Comentarios</h2>
    </section>

    <footer>
        <magic-footer></magic-footer>
    </footer>

    <script type="module" src="/public/Components/Components.js"></script>

    <script type="module" src="/comment.js"></script>
</body>

</html>